#!/bin/sh
# 等待网络服务初始化（避免WIFI设备未加载）
sleep 8

# 清除原有无线配置
uci delete wireless.@wifi-device[0] 2>/dev/null
uci delete wireless.@wifi-iface[0] 2>/dev/null

# 1. 配置2.4G WIFI（mt7916为例，根据实际芯片调整path）
uci set wireless.radio0=wifi-device
uci set wireless.radio0.type='mac80211'
uci set wireless.radio0.path='platform/fe610000.spi'  # 对应dts中spi节点（需与硬件匹配）
uci set wireless.radio0.htmode='HT20'  # 2.4G模式（HT20=20MHz带宽）
uci set wireless.radio0.channel='6'    # 2.4G信道（1/6/11避免干扰）
uci set wireless.radio0.disabled='0'   # 启用2.4G WIFI

# 2. 配置2.4G热点
uci set wireless.default_radio0=wifi-iface
uci set wireless.default_radio0.device='radio0'
uci set wireless.default_radio0.network='lan'  # WIFI接入LAN网段
uci set wireless.default_radio0.mode='ap'
uci set wireless.default_radio0.ssid='iStoreOS-Xiguapi-2.4G'  # 2.4G SSID
uci set wireless.default_radio0.encryption='psk2'  # WPA2加密
uci set wireless.default_radio0.key='12345678'     # WIFI密码（可修改）

# 3. 若支持5G WIFI，新增5G配置（可选）
if uci show wireless | grep -q 'radio1'; then
    uci set wireless.radio1.disabled='0'
    uci set wireless.radio1.htmode='VHT80'  # 5G模式（80MHz带宽）
    uci set wireless.radio1.channel='36'    # 5G信道（36/40/44/48）
    uci set wireless.default_radio1=wifi-iface
    uci set wireless.default_radio1.device='radio1'
    uci set wireless.default_radio1.network='lan'
    uci set wireless.default_radio1.mode='ap'
    uci set wireless.default_radio1.ssid='iStoreOS-Xiguapi-5G'
    uci set wireless.default_radio1.encryption='psk2'
    uci set wireless.default_radio1.key='12345678'
fi

# 4. 提交配置并重启无线服务
uci commit wireless
/etc/init.d/network restart
/etc/init.d/hostapd restart
