jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - name: 拉取仓库代码
        uses: actions/checkout@v4  # 默认拉取 main 分支

      # 调试：验证文件存在性
      - name: 验证配置文件
        run: |
          echo "当前仓库根目录：$GITHUB_WORKSPACE"
          ls -la $GITHUB_WORKSPACE/xgp-5g.config

      - name: 初始化编译环境
        # ...（保持原有环境配置）

      - name: 克隆iStoreOS源码
        run: |
          git clone --depth=1 https://github.com/istoreos/istoreos.git
          cd istoreos
          ./scripts/feeds update -a
          ./scripts/feeds install -a

      - name: 集成5G-Modem-Support
        run: |
          cd istoreos
          rm -rf package/feeds/packages/quectel-MHI package/feeds/packages/qmi-utils package/feeds/packages/wwan
          git clone --depth=1 https://github.com/Siriling/5G-Modem-Support package/5G-Modem-Support
          ./scripts/feeds install -a -p 5G-Modem-Support

      - name: 加载配置文件
        run: |
          cd istoreos
          cp "$GITHUB_WORKSPACE/xgp-5g.config" .config
          make defconfig

      # ...（后续编译步骤保持不变）
